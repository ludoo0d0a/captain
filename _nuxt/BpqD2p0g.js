import{f as T,g as A,j as l,r as _,c as n,a as s,d as c,t as i,k as g,v as B,l as E,F as w,m as M,h as N,i as j,o as r,n as x}from"./Ynf5fPIE.js";import{u as q}from"./C8vFggs1.js";import{u as F}from"./DRM8XXcm.js";import{u as R,a as U}from"./CnAt3jol.js";const L={class:"max-w-lg mx-auto mt-10 bg-white rounded shadow p-6"},O={key:0},z={class:"mb-2"},G={class:"mb-2"},H={class:"mb-4 flex items-center gap-4"},J={class:"mb-4"},K=["value"],Q={key:0},W=["disabled"],X={key:1,class:"text-red-500"},se=T({__name:"promote",setup(Y){const f=A(),k=N(),b=j("showToast"),d=f.query.appId,u=f.query.envId,I=q(),S=F(),V=R(),y=U(),p=l(()=>I.applications.find(e=>e.id===d)),v=l(()=>S.environments.find(e=>e.id===u)),m=_(!1),a=_(""),D=l(()=>y.deployments.filter(e=>e.appId===d&&e.envId!==u).map(e=>({env:S.environments.find(o=>o.id===e.envId),version:V.versions.find(o=>o.id===e.versionId)})).filter(e=>e.env&&e.version)),C=l(()=>D.value.filter(e=>e.version&&(m.value||!e.version.isSnapshot)));function P(){if(!a.value||!p.value||!v.value)return;const e=new Date().toISOString();y.addDeployment({id:"dep-"+Math.random().toString(36).slice(2),appId:d,envId:u,versionId:a.value,status:"deployed",deployedAt:e}),b&&b("Version promoted successfully!","success"),k.push("/")}return(e,o)=>(r(),n("div",L,[o[6]||(o[6]=s("h2",{class:"text-2xl font-bold mb-4"},"Promote Version",-1)),p.value&&v.value?(r(),n("div",O,[s("div",z,[o[2]||(o[2]=s("span",{class:"font-semibold"},"App:",-1)),c(" "+i(p.value.name),1)]),s("div",G,[o[3]||(o[3]=s("span",{class:"font-semibold"},"Target Environment:",-1)),c(" "+i(v.value.name),1)]),s("div",H,[o[4]||(o[4]=s("label",{class:"font-medium"},"Show Snapshots",-1)),g(s("input",{type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=t=>m.value=t)},null,512),[[B,m.value]])]),s("div",J,[o[5]||(o[5]=s("label",{class:"block mb-1 font-medium"},"Select Version to Promote",-1)),g(s("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>a.value=t),class:"w-full border rounded px-3 py-2"},[(r(!0),n(w,null,M(C.value,t=>{var h;return r(),n(w,{key:(h=t.version)==null?void 0:h.id},[t.env&&t.version?(r(),n("option",{key:0,value:t.version.id},[c(i(t.version.name)+" from "+i(t.env.name)+" ",1),t.version.isSnapshot?(r(),n("span",Q,"(snapshot)")):x("",!0)],8,K)):x("",!0)],64)}),128))],512),[[E,a.value]])]),s("button",{class:"w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 font-semibold",disabled:!a.value,onClick:P}," Promote ",8,W)])):(r(),n("div",X,"Invalid app or environment."))]))}});export{se as default};
