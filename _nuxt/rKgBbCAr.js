import{f as F,C as H,r as v,D as W,j as S,c as o,a as s,b as Q,w as q,y as N,k as x,B as g,F as h,m as E,E as C,n as p,e as G,o as l,t as L,A as V}from"./Ynf5fPIE.js";import{u as J}from"./DRM8XXcm.js";const O={class:"w-full min-h-screen bg-gray-50 p-8"},P={class:"flex items-center mb-8"},X={key:0,class:"flex justify-center items-center min-h-[200px]"},Y={key:1,class:"bg-white rounded shadow p-6"},Z={class:"flex items-center mb-4"},ee=["disabled"],te={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ne={key:1,class:"animate-spin h-5 w-5 text-blue-600",fill:"none",viewBox:"0 0 24 24"},oe={class:"divide-y mb-4"},se=["onKeyup"],le={key:1,class:"flex-1"},ae={key:2,class:"relative w-48"},ie=["onKeyup"],re={key:0,class:"absolute z-10 bg-white border rounded shadow mt-1 w-full max-h-32 overflow-auto"},ue=["onMousedown"],de={key:0,class:"inline-block text-gray-400 text-xs"},ce=["onClick"],ve=["onClick"],me=["onClick"],pe={class:"flex gap-2 mb-2 items-start"},we={class:"relative w-48"},fe={key:0,class:"absolute z-10 bg-white border rounded shadow mt-1 w-full max-h-32 overflow-auto"},xe=["onMousedown"],be=F({__name:"manage-environments",setup(ge){const u=J(),{environments:w,loading:M}=H(u),f=v(""),d=v(""),c=v(""),m=v(""),r=v(""),y=v("");W(async()=>{console.log("Environments page onMounted called"),await u.fetchEnvironments(),console.log("Environments loaded:",w.value.length)}),w.value.length===0&&(console.log("No environments found, fetching..."),u.fetchEnvironments());const k=S(()=>{const n=new Set;return w.value.forEach(e=>(e.tags||[]).forEach(a=>n.add(a))),Array.from(n).sort()}),j=S(()=>{if(!y.value.trim())return w.value;const n=y.value.trim().toLowerCase();return w.value.filter(e=>e.name.toLowerCase().includes(n)||e.tags&&e.tags.some(a=>a.toLowerCase().includes(n)))}),b=v([]);function I(){var e;const n=((e=d.value.split(",").pop())==null?void 0:e.trim().toLowerCase())||"";b.value=n?k.value.filter(a=>a.toLowerCase().startsWith(n)&&!d.value.split(",").map(t=>t.trim().toLowerCase()).includes(a.toLowerCase())):k.value.filter(a=>!d.value.split(",").map(t=>t.trim().toLowerCase()).includes(a.toLowerCase()))}function K(n){let e=d.value.split(",").map(a=>a.trim()).filter(Boolean);e.includes(n)||e.push(n),d.value=e.join(", ")+", ",b.value=[]}const _=v([]);function $(){var e;const n=((e=r.value.split(",").pop())==null?void 0:e.trim().toLowerCase())||"";_.value=n?k.value.filter(a=>a.toLowerCase().startsWith(n)&&!r.value.split(",").map(t=>t.trim().toLowerCase()).includes(a.toLowerCase())):k.value.filter(a=>!r.value.split(",").map(t=>t.trim().toLowerCase()).includes(a.toLowerCase()))}function U(n){let e=r.value.split(",").map(a=>a.trim()).filter(Boolean);e.includes(n)||e.push(n),r.value=e.join(", ")+", ",_.value=[]}async function T(){if(!f.value.trim())return;const n=d.value.split(",").map(e=>e.trim()).filter(Boolean);await u.addEnvironment({id:"env-"+Math.random().toString(36).slice(2),name:f.value.trim(),tags:n}),await u.fetchEnvironments(),f.value="",d.value=""}function z(n){c.value=n.id,m.value=n.name,r.value=(n.tags||[]).join(", ")}async function B(n){if(!m.value.trim())return;const e=r.value.split(",").map(a=>a.trim()).filter(Boolean);await u.updateEnvironment(n.id,{name:m.value.trim(),tags:e}),await u.fetchEnvironments(),c.value="",m.value="",r.value=""}function A(){c.value="",m.value="",r.value=""}async function D(n){await u.removeEnvironment(n),await u.fetchEnvironments()}async function R(){await u.fetchEnvironments()}return(n,e)=>{const a=G;return l(),o("div",O,[s("div",P,[Q(a,{to:"/",class:"mr-4"},{default:q(()=>e[5]||(e[5]=[s("button",{class:"p-2 rounded hover:bg-gray-100",title:"Back to Environments"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})])],-1)])),_:1,__:[5]}),e[6]||(e[6]=s("h1",{class:"text-3xl font-bold"},"Manage Environments",-1))]),N(M)?(l(),o("div",X,e[7]||(e[7]=[s("svg",{class:"animate-spin h-8 w-8 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})],-1)]))):(l(),o("div",Y,[s("div",Z,[e[10]||(e[10]=s("h3",{class:"text-xl font-semibold flex-1"},"Environments",-1)),x(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),class:"border rounded px-2 py-1 text-sm ml-4 w-64",placeholder:"Quick filter by name or tag"},null,512),[[g,y.value]]),s("button",{onClick:R,disabled:N(M),class:"ml-2 p-2 rounded hover:bg-gray-100 disabled:opacity-50",title:"Refresh environments"},[N(M)?(l(),o("svg",ne,e[9]||(e[9]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"},null,-1)]))):(l(),o("svg",te,e[8]||(e[8]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])))],8,ee)]),s("ul",oe,[(l(!0),o(h,null,E(j.value,t=>(l(),o("li",{key:t.id,class:"py-3 flex items-center gap-2"},[c.value===t.id?x((l(),o("input",{key:0,"onUpdate:modelValue":e[1]||(e[1]=i=>m.value=i),class:"border rounded px-2 py-1 text-sm flex-1",onKeyup:C(i=>B(t),["enter"])},null,40,se)),[[g,m.value]]):(l(),o("span",le,L(t.name),1)),c.value===t.id?(l(),o("div",ae,[x(s("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>r.value=i),class:"border rounded px-2 py-1 text-xs w-full",placeholder:"Tags (comma separated)",onInput:$,onKeyup:C(i=>B(t),["enter"])},null,40,ie),[[g,r.value]]),_.value.length?(l(),o("ul",re,[(l(!0),o(h,null,E(_.value,i=>(l(),o("li",{key:i,class:"px-2 py-1 text-xs cursor-pointer hover:bg-blue-100",onMousedown:V(he=>U(i),["prevent"])},L(i),41,ue))),128))])):p("",!0)])):(l(),o(h,{key:3},[(l(!0),o(h,null,E(t.tags||[],i=>(l(),o("span",{key:i,class:"inline-block bg-gray-100 text-gray-700 text-xs rounded px-2 py-1 mr-1 min-w-[2.5rem] text-center"},L(i),1))),128)),!t.tags||!t.tags.length?(l(),o("span",de,"â€”")):p("",!0)],64)),c.value!==t.id?(l(),o("button",{key:4,class:"text-xs text-blue-600",onClick:i=>z(t)},"Rename/Tags",8,ce)):p("",!0),c.value===t.id?(l(),o("button",{key:5,class:"text-xs text-green-600",onClick:i=>B(t)},"Save",8,ve)):p("",!0),c.value===t.id?(l(),o("button",{key:6,class:"text-xs text-gray-500",onClick:A},"Cancel")):p("",!0),s("button",{class:"text-xs text-red-600",onClick:i=>D(t.id)},"Delete",8,me)]))),128))]),s("div",pe,[x(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t),class:"border rounded px-2 py-1 text-sm flex-1",placeholder:"New environment name",onKeyup:C(T,["enter"])},null,544),[[g,f.value]]),s("div",we,[x(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>d.value=t),class:"border rounded px-2 py-1 text-xs w-full",placeholder:"Tags (comma separated)",onInput:I,onKeyup:C(T,["enter"])},null,544),[[g,d.value]]),b.value.length?(l(),o("ul",fe,[(l(!0),o(h,null,E(b.value,t=>(l(),o("li",{key:t,class:"px-2 py-1 text-xs cursor-pointer hover:bg-blue-100",onMousedown:V(i=>K(t),["prevent"])},L(t),41,xe))),128))])):p("",!0)]),s("button",{class:"bg-blue-500 text-white px-3 py-1 rounded text-sm",onClick:T},"Add")])]))])}}});export{be as default};
